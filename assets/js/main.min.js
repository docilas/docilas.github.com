"use strict";$(function(){function e(){O=!device.mobile()&&!device.tablet()}function t(){k=$("#bg").height(),O&&(.5625*window.innerWidth<window.innerHeight?D.scale.set(window.innerHeight/.5625/1920):D.scale.set(.5625*window.innerWidth/1080),TweenMax.set(".work_list",{y:-k*(y+1)}))}function n(e,t){m=0,w=$(e+" img").length,TweenMax.to("#loading",.5,{autoAlpha:1}),TweenMax.set("#loading .progress",{width:"1%"}),$(e).imagesLoaded({background:!0}).always(function(){console.log("all images loaded"),TweenMax.to("#loading",.5,{autoAlpha:0,delay:.5,onComplete:function(){"function"==typeof t&&t()}})}).done(function(){console.log("all images successfully loaded")}).fail(function(){console.log("all images loaded, at least one is broken")}).progress(function(e,t){var n=t.isLoaded?"loaded":"broken";console.log("image is "+n+" for "+t.img.src),m++,TweenMax.to("#loading .progress",.3,{width:m/w*100+"%"})})}function i(){P.addChild(D,F,W,L),P.filters=[A],E.stage.addChild(P,I),E.ticker.add(function(){p+=O?.05:.01,I.rotation+=.005,window.innerWidth>768&&(I.scale.x=2+.2*Math.sin(p),I.scale.y=2+.2*Math.cos(p)),"home"==b&&(L.scale.x=1+.003*Math.cos(p),L.scale.y=1+.006*Math.sin(p))}),TweenMax.fromTo("#bg canvas",1.5,{z:200},{z:d,alpha:1,ease:Sine.easeOut}),TweenMax.fromTo(L,1.5,{alpha:0},{alpha:1,delay:.25,ease:Sine.easeOut,onComplete:o}),TweenMax.set("html",{className:"+=init_done",delay:2.5})}function r(){$("html").hasClass("menu-open")?$("html").removeClass("menu-open"):$("html").addClass("menu-open")}function o(){X.restart()}function a(e){_=!0,b="worklist",TweenMax.set(".list_num",{className:"+=hide"}),"up"==e?(y--,x=$(".sec_work .work").eq(y),v=$(".sec_work .work").eq(y+1)):(y++,x=$(".sec_work .work").eq(y),v=$(".sec_work .work").eq(y-1)),TweenMax.to(".work_list",.75,{y:-k*(y+1),ease:Circ.easeInOut,onComplete:s}),$(".work_num").attr("data-num",y+1),v.removeClass("active"),x.addClass("active"),window.innerWidth>768&&(0!==y&&(TweenMax.fromTo(v.find(".masthead"),.5,{z:10},{z:-20,ease:Circ.easeOut}),TweenMax.fromTo(v.find(".info"),.5,{z:40},{z:-15,ease:Circ.easeOut})),TweenMax.fromTo(x.find(".masthead"),.6,{z:-20},{z:10,delay:.5,ease:Circ.easeOut}),TweenMax.fromTo(x.find(".info"),.75,{z:-15},{z:40,delay:.6,ease:Circ.easeOut})),-1==y?(b="home",d=-10,TweenMax.to("#bg canvas",.5,{z:d,ease:Sine.easeOut}),TweenMax.set("#bg .tip",{className:"-=hide"}),X.restart(),ga("send","page-Home")):(TweenMax.set(".list_num",{className:"-=hide",delay:.2}),TweenMax.set("#bg .tip",{className:"+=hide"}),0==y&&(d=O?-50:-30,TweenMax.to("#bg canvas",.5,{z:d,ease:Sine.easeOut}),TweenMax.set(".list_num",{className:"+=hide"})),ga("send","page-Work-"+(y+1))),f=Math.abs(d/10)}function s(){_=!1}function l(){$(".img_frame").slick({autoplay:!0,arrows:!1})}function c(){function e(){TweenMax.to("#mask .masthead",.5,{y:($("#mask .masthead")[0].offsetHeight-k)/2,delay:.25,ease:Circ.easeOut}),TweenMax.set("#mask",{className:"-=show work-"+(y+1),delay:.75}),TweenMax.set(".sec_work_inner",{className:"+=show work-"+(y+1),alpha:1,delay:.75})}window.innerWidth>768?TweenMax.fromTo("#mask .masthead",.5,{width:"83%",paddingTop:"37%"},{width:"100%",paddingTop:"30%",ease:Circ.easeOut,onComplete:e}):(TweenMax.set(".sec_work_inner",{className:"+=show work-"+(y+1)}),TweenMax.to(".sec_work_inner",.5,{alpha:1,delay:.1}))}function u(){function e(){TweenMax.set(".sec_work_inner",{className:"-=show work-"+(y+1)}),_=!1}window.innerWidth>768&&TweenMax.set("#mask .masthead",{width:"83%",paddingTop:"37%",y:"0"}),TweenMax.to(".sec_work_inner",.5,{alpha:0}),TweenMax.fromTo(".sec_work",.5,{alpha:0},{alpha:1,delay:.75,onComplete:e})}function h(e){var t=e.gamma/90,n=e.beta/90;"worklist"==b&&TweenMax.set("#bg canvas",{rotationX:5*-n/f,rotationY:5*t/f,x:10*-t/f+"%",y:10*-n/f+"%"})}var d=-10,f=Math.abs(d/10),p=0,m=void 0,w=void 0,g=7,y=-1,v=void 0,x=void 0,_=($(".sec_work .work").length,!1),b="home",T="",k=void 0,C=void 0,M=!1,O=void 0;e(),$.ajax({dataType:"json",url:"work_inner.json",success:function(e){C=e,M=!0}});var S={loading:function(){console.log("font loading")},active:function(){console.log("font active"),n("body",i)},google:{families:["Poppins:400,700"]}};WebFont.load(S);var E=new PIXI.Application(window.innerWidth,window.innerHeight);$("#bg").append(E.view);var P=new PIXI.Container,I=PIXI.Sprite.fromImage("assets/images/filter.png"),A=new PIXI.filters.DisplacementFilter(I);I.anchor.set(.5),I.position={x:E.renderer.width/2,y:E.renderer.height/2};var D=PIXI.Sprite.fromImage("assets/images/bg.jpg");t(),D.anchor.set(.5),D.position={x:E.renderer.width/2,y:E.renderer.height/2};var R=window.innerWidth<1e3?"CHIH\nYUAN\nKUO":"CHIH YUAN KUO",N=void 0;N=window.innerWidth>1366?150:window.innerWidth>480?100:80;var L=new PIXI.Text(R,{fontWeight:700,fontSize:N,fontFamily:"Poppins",fill:"#333",align:"center",strokeThickness:0});L.anchor.set(.5),L.blendMode=PIXI.BLEND_MODES.ADD,L.position={x:E.renderer.width/2,y:E.renderer.height/2};var F=new PIXI.Text(R,{fontWeight:700,fontSize:N,fontFamily:"Poppins",fill:"#FC577D",align:"center",strokeThickness:0});F.anchor.set(.5),F.blendMode=PIXI.BLEND_MODES.ADD,F.position={x:E.renderer.width/2,y:E.renderer.height/2},F.alpha=0;var W=new PIXI.Text(R,{fontWeight:700,fontSize:N,fontFamily:"Poppins",fill:"#54F3B7",align:"center",strokeThickness:0});W.anchor.set(.5),W.blendMode=PIXI.BLEND_MODES.ADD,W.position={x:E.renderer.width/2,y:E.renderer.height/2},W.alpha=0;var X=new TimelineMax({repeat:1,repeatDelay:.1,paused:!0});if(X.to(F,.05,{alpha:.4,x:L.x-g,y:L.y+g,ease:Circ.easeOut}).to(W,.05,{alpha:.4,x:L.x+g,y:L.y-g,ease:Circ.easeOut},"-=.05").to(F,.05,{x:L.x-g,y:L.y-g,ease:Circ.easeOut}).to(W,.05,{x:L.x+g,y:L.y+g,ease:Circ.easeOut},"-=.05").to(F,.05,{x:L.x+g,y:L.y+g,ease:Circ.easeOut}).to(W,.05,{x:L.x-g,y:L.y-g,ease:Circ.easeOut},"-=.05").to(F,.05,{x:L.x+g,y:L.y-g,ease:Circ.easeOut}).to(W,.05,{x:L.x-g,y:L.y+g,ease:Circ.easeOut},"-=.05").to(F,.05,{x:L.x,y:L.y,ease:Circ.easeOut}).to(W,.05,{x:L.x,y:L.y,ease:Circ.easeOut},"-=.05").to(F,.05,{x:L.x-g,y:L.y+g,ease:Circ.easeOut},"+=.2").to(W,.05,{x:L.x+g,y:L.y-g,ease:Circ.easeOut},"-=.05").to(F,.05,{x:L.x-g,y:L.y-g,ease:Circ.easeOut}).to(W,.05,{x:L.x+g,y:L.y+g,ease:Circ.easeOut},"-=.05").to(F,.05,{x:L.x+g,y:L.y+g,ease:Circ.easeOut}).to(W,.05,{x:L.x-g,y:L.y-g,ease:Circ.easeOut},"-=.05").to(F,.05,{x:L.x+g,y:L.y-g,ease:Circ.easeOut}).to(W,.05,{x:L.x-g,y:L.y+g,ease:Circ.easeOut},"-=.05").to(F,.05,{x:L.x,y:L.y,alpha:.1,ease:Circ.easeOut}).to(W,.05,{x:L.x,y:L.y,alpha:.1,ease:Circ.easeOut},"-=.05"),$(window).resize(t),$("#menu-trigger").on("click",r),$("#menu .btn").on("click",r),O){new WheelIndicator({callback:function(e){if(!_&&"about"!==b&&"workinner"!==b){if("up"==e.direction&&-1==y)return!1;if("down"==e.direction&&y==$(".sec_work .work").length-1)return!1;a(e.direction)}},preventMouse:!1});$("body").on("mousemove",function(e){var t=e.clientX/window.innerWidth-.5,n=e.clientY/window.innerHeight-.5;TweenMax.to("#bg canvas",.5,{rotationX:7*-n/f,rotationY:7*t/f,x:10*-t/f+"%",y:10*-n/f+"%"}),"worklist"==b&&(TweenMax.to(x.find(".masthead"),.75,{rotationX:5*-n,rotationY:5*t,x:5*-t+"%",y:5*-n+"%"}),TweenMax.to(x.find(".info"),1,{rotationX:7*-n,rotationY:7*t,x:10*-t+"%",y:10*-n+"%"}))})}else{var j=new Hammer($(".sec_work")[0]);j.get("swipe").set({direction:Hammer.DIRECTION_VERTICAL}),j.on("swipeup swipedown",function(e){return!_&&"about"!==b&&"workinner"!==b&&(("swipedown"!=e.type||-1!=y)&&(("swipeup"!=e.type||y!=$(".sec_work .work").length-1)&&void a("swipeup"==e.type?"down":"up")))}),window.addEventListener("deviceorientation",h)}$(".btn-work").on("click",function(){"worklist"!==b&&(a("down"),ga("send","event","btn","click","btn-work"))}),$(".btn-home").on("click",function(){_||(y=0,a("up"),ga("send","event","btn","click","btn-home"))}),$(".btn-about").on("click",function(){T=b,b="about",TweenMax.set(".sec_about",{className:"+=show"}),TweenMax.to(".sec_about ",.6,{alpha:1,ease:Sine.easeOut}),TweenMax.to(".sec_about .wrapper",.5,{x:"0%",delay:.2,ease:Circ.easeOut}),ga("send","event","btn","click","btn-about")}),$(".close-about").on("click",function(){b=T,TweenMax.to(".sec_about ",.3,{alpha:0,delay:.1,ease:Circ.easeOut}),TweenMax.to(".sec_about .wrapper",.5,{x:"-20%"}),TweenMax.set(".sec_about",{className:"-=show",delay:.55,ease:Circ.easeOut}),ga("send","event","btn","click","btn-close-about")}),$(".btn-discover").on("click",function(){M&&(T=b,b="workinner",$(".sec_work_inner .inner").html(C["work-"+(y+1)]),l(),n(".sec_work_inner",c),ga("send","page-Workinner-"+(y+1)),TweenMax.to(".sec_work",.3,{alpha:0}),window.innerWidth>768&&TweenMax.set("#mask",{className:"+=show work-"+(y+1)})),ga("send","event","btn","click","btn-discover")}),$(".close-workinner").on("click",function(){b=T,_=!0,u(),ga("send","event","btn","click","btn-close-workinner")}),$("body").on("click",".btn-back",function(){$("html,body").animate({scrollTop:0},500)}),$("body").on("click","a",function(){ga("send","event","a","link-to",this.href)})});